<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>3D Earthquake Intensity Map</title>

  <!-- MapLibre (free Mapbox alternative) -->
  <script src="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.js"></script>
  <link href="https://unpkg.com/maplibre-gl@3.6.1/dist/maplibre-gl.css" rel="stylesheet" />

  <!-- deck.gl -->
  <script src="https://unpkg.com/deck.gl@8.9.34/dist.min.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    #map { width: 100vw; height: 100vh; }
    #deck-canvas {
      position: absolute;
      pointer-events: none;
      z-index: 10;
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <script>
    const map = new maplibregl.Map({
      container: 'map',
      style: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
      center: [0, 20],
      zoom: 1.8,
      pitch: 60,
      bearing: -20
    });

    map.addControl(new maplibregl.NavigationControl());

    const deckgl = new deck.Deck({
      canvas: 'deck-canvas',
      initialViewState: {
        longitude: 0,
        latitude: 20,
        zoom: 1.8,
        pitch: 60,
        bearing: -20
      },
      controller: true,
      layers: []
    });

    fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_month.geojson')
      .then(r => r.json())
      .then(data => {
        const layer = new deck.ColumnLayer({
          id: 'earthquakes',
          data: data.features,
          diskResolution: 12,
          radius: 20000,
          extruded: true,
          elevationScale: 50000,
          getPosition: d => d.geometry.coordinates,
          getElevation: d => Math.max(d.properties.mag, 0),
          getFillColor: d => {
            const m = d.properties.mag || 0;
            return m > 6 ? [255, 60, 60] :
                   m > 4 ? [255, 160, 60] :
                           [255, 220, 140];
          },
          pickable: true
        });

        deckgl.setProps({ layers: [layer] });
      });
  </script>
</body>
</html>
